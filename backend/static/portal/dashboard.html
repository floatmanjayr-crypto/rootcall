<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>RootCall — Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="./styles.css"/>
</head>
<body>
  <div class="container">
    <div class="header">
      <h2>RootCall — Client Portal</h2>
      <div>
        <button id="logout" class="btn btn-ghost">Log out</button>
      </div>
    </div>
    <div id="flash" class="notice hidden"></div>

    <div class="grid grid-2">
      <div class="card">
        <h3>Today</h3>
        <div class="small">Calls and protection summary</div>
        <div id="today" style="margin-top:10px"></div>
      </div>
      <div class="card">
        <h3>Account</h3>
        <div class="small">Plan & status</div>
        <div id="acct" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

  <script src="./auth.js"></script>
  <script>
    const flash = document.getElementById("flash");
    function showFlash(t, bad=false){
      flash.textContent = t;
      flash.className = "notice" + (bad ? " bad" : "");
      flash.classList.remove("hidden");
      setTimeout(()=>flash.classList.add("hidden"), 3000);
    }

    async function load(){
      try{
        const d = await apiFetch("/api/rootcall/dashboard");
        const stats = d.stats || {};
        document.getElementById("today").innerHTML = `
          <div>Calls today: <strong>${stats.calls_today ?? "—"}</strong></div>
          <div>Blocked: <strong class="good">${stats.blocked ?? "—"}</strong></div>
        `;
        document.getElementById("acct").innerHTML = `
          <div>User: <code>${(d.user && d.user.user_id) || "current"}</code></div>
          <div>Status: <strong>Active</strong></div>
        `;
      }catch(e){
        // Not authenticated -> go to login
        location.href = "./login.html";
      }
    }

    document.getElementById("logout").onclick = async ()=>{
      try{ await logout(); }catch(e){}
    };

    load();
  </script>
</body>
</html>
