<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RootCall Dashboard - Your Protection Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #0d3d2f;
            --ivory: #f9f6f3;
            --accent: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--ivory);
            color: var(--green);
            line-height: 1.6;
        }
        
        /* Header */
        header {
            background: var(--green);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            color: white;
        }
        
        .user-name {
            font-weight: 600;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 50px;
        }
        
        .btn-logout {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-logout:hover {
            background: white;
            color: var(--green);
            transform: translateY(-2px);
        }
        
        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        /* Hero Number */
        .number-hero {
            background: linear-gradient(135deg, var(--green) 0%, #1a5a42 100%);
            color: white;
            padding: 50px 40px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(13, 61, 47, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .number-hero::before {
            content: '️';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 200px;
            opacity: 0.1;
        }
        
        .number-hero h1 {
            font-size: 3rem;
            margin: 15px 0;
            letter-spacing: 3px;
            font-weight: 800;
        }
        
        .status-badge {
            display: inline-block;
            background: #2ecc71;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 700;
            margin-top: 10px;
        }
        
        .copy-number-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 20px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .copy-number-btn:hover {
            background: white;
            color: var(--green);
        }
        
        /* Navigation Tabs */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            color: var(--green);
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.95rem;
        }
        
        .tab-btn:hover {
            background: var(--ivory);
        }
        
        .tab-btn.active {
            background: var(--green);
            color: white;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .stat-card h3 {
            font-size: 2.5rem;
            color: var(--green);
            margin-bottom: 8px;
            font-weight: 800;
        }
        
        .stat-card p {
            color: #666;
            font-weight: 600;
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .card h2 {
            margin-bottom: 20px;
            color: var(--green);
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: var(--green);
            font-size: 1.2rem;
        }
        
        /* Two Column Layout */
        .two-column {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 1024px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
        
        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--ivory);
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: var(--green);
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tr:hover {
            background: #f9f9f9;
        }
        
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge.blocked { background: #ffebee; color: #c62828; }
        .badge.forwarded { background: #e8f5e9; color: #2e7d32; }
        .badge.screened { background: #fff3e0; color: #e65100; }
        .badge.missed { background: #f3f3f3; color: #666; }
        
        /* Forms */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--green);
        }
        
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }
        
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--green);
            box-shadow: 0 0 0 3px rgba(13, 61, 47, 0.1);
        }
        
        .input-group small {
            display: block;
            margin-top: 6px;
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Buttons */
        .btn {
            background: var(--green);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.95rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(13, 61, 47, 0.3);
        }
        
        .btn:hover {
            background: #1a5a42;
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(13, 61, 47, 0.4);
        }
        
        .btn-secondary {
            background: var(--ivory);
            color: var(--green);
            border: 2px solid var(--green);
            box-shadow: none;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        /* Contact List */
        .contact-list {
            list-style: none;
        }
        
        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--ivory);
            margin-bottom: 10px;
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .contact-item:hover {
            background: #ede9e4;
        }
        
        /* Fraud Alert Box */
        .fraud-alert {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border: 2px solid var(--danger);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .fraud-alert h3 {
            color: var(--danger);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .fraud-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid var(--danger);
        }
        
        .fraud-item h4 {
            color: var(--danger);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .fraud-item p {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 80px 20px;
        }
        
        .spinner {
            border: 4px solid var(--ivory);
            border-top: 4px solid var(--green);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Alert Messages */
        .alert {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196f3;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border-left: 5px solid var(--warning);
        }
        
        /* Provision Card */
        .provision-card {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid var(--accent);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .provision-card h3 {
            color: #2e7d32;
            margin-bottom: 20px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-close {
            float: right;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .number-hero h1 {
                font-size: 2rem;
            }
            
            .stat-card h3 {
                font-size: 2rem;
            }
            
            .nav {
                flex-direction: column;
                gap: 15px;
            }
            
            .tab-navigation {
                overflow-x: auto;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="nav">
            <div class="logo">️ RootCall</div>
            <div class="user-info">
                <span class="user-name" id="user-name">Loading...</span>
                <button class="btn-logout" onclick="logout()">Sign Out</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading your protection dashboard...</p>
        </div>

        <!-- No Payment State -->
        <div id="no-payment" style="display:none;">
            <div class="alert alert-info">
                <h3> Welcome to RootCall!</h3>
                <p style="font-size:1.1rem;margin-bottom:20px;">You're one step away from complete phone protection.</p>
                <p>Complete your payment to receive your dedicated RootCall protection number.</p>
                <br>
                <a href="/index.html#pricing" class="btn">Choose Your Plan</a>
            </div>
        </div>

        <!-- Payment Complete but No Number (provision failed) -->
        <div id="pending-provision" style="display:none;">
            <div class="alert alert-warning">
                <h3>⏳ Setting Up Your Protection...</h3>
                <p style="margin-bottom:20px;">Your payment was successful! We're provisioning your RootCall number now.</p>
                <p style="font-size:0.9rem;color:#666;">This usually takes 30-60 seconds. If it's been longer, click below to manually provision.</p>
                <br>
                <button class="btn" onclick="showProvisionModal()">�� Get My Number Now</button>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard" style="display:none;">
            <!-- Hero Number Display -->
            <div class="number-hero">
                <p style="font-size:0.9rem;text-transform:uppercase;letter-spacing:2px;opacity:0.8;">Your RootCall Protection Number</p>
                <h1 id="rootcall-number">Loading...</h1>
                <button class="copy-number-btn" onclick="copyNumber()"> Copy Number</button>
                <br>
                <span class="status-badge">● ACTIVE & PROTECTING</span>
                <p id="purchased-date" style="margin-top:12px;font-size:0.9rem;">Activated: Loading...</p>
            </div>

            <!-- Quick Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"></div>
                    <h3 id="stat-today">0</h3>
                    <p>Calls Today</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"></div>
                    <h3 id="stat-blocked">0</h3>
                    <p>Spam Blocked</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">✅</div>
                    <h3 id="stat-forwarded">0</h3>
                    <p>Calls Forwarded</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"></div>
                    <h3 id="stat-total">0</h3>
                    <p>Total Calls</p>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="showTab('overview')"> Overview</button>
                <button class="tab-btn" onclick="showTab('calls')"> Call History</button>
                <button class="tab-btn" onclick="showTab('settings')">⚙️ Settings</button>
                <button class="tab-btn" onclick="showTab('contacts')"> Trusted Contacts</button>
                <button class="tab-btn" onclick="showTab('fraud')">⚠️ Fraud Alerts</button>
            </div>

            <!-- Tab: Overview -->
            <div id="tab-overview" class="tab-content active">
                <div class="two-column">
                    <div>
                        <!-- Recent Activity -->
                        <div class="card">
                            <h2> Recent Call Activity</h2>
                            <table id="recent-calls-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Caller</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-calls-body">
                                    <tr>
                                        <td colspan="4" class="empty-state">
                                            <div class="empty-state-icon"></div>
                                            <p>No calls yet. Share your RootCall number to start protecting yourself!</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Quick Setup -->
                        <div class="card">
                            <h2> Quick Setup</h2>
                            <div class="input-group">
                                <label>Your Real Phone Number (where calls forward to):</label>
                                <input type="tel" id="quick-forward" placeholder="+1 (555) 123-4567">
                            </div>
                            <button class="btn" onclick="updateForwarding()"> Save & Activate</button>
                        </div>
                    </div>

                    <div>
                        <!-- Fraud Alerts Preview -->
                        <div class="fraud-alert">
                            <h3>⚠️ Active Fraud Warnings</h3>
                            <div class="fraud-item">
                                <h4>IRS Phone Scams</h4>
                                <p>Scammers pretending to be IRS demanding immediate payment. IRS never calls!</p>
                            </div>
                            <div class="fraud-item">
                                <h4>Tech Support Scams</h4>
                                <p>"Your computer has a virus" - Microsoft/Apple don't make unsolicited calls.</p>
                            </div>
                            <button class="btn btn-secondary btn-small" onclick="showTab('fraud')" style="width:100%;margin-top:10px;">View All Fraud Alerts</button>
                        </div>

                        <!-- How It Works -->
                        <div class="card">
                            <h3> How RootCall Works</h3>
                            <ol style="line-height:2;padding-left:20px;">
                                <li>Give out your RootCall number</li>
                                <li>AI screens every incoming call</li>
                                <li>Scams are blocked automatically</li>
                                <li>Real calls are forwarded to you</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Call History -->
            <div id="tab-calls" class="tab-content">
                <div class="card">
                    <h2> Complete Call History</h2>
                    
                    <div style="margin-bottom:20px;display:flex;gap:10px;">
                        <select id="filter-status" style="padding:10px;border-radius:8px;border:2px solid #e0e0e0;">
                            <option value="all">All Calls</option>
                            <option value="blocked">Blocked</option>
                            <option value="forwarded">Forwarded</option>
                            <option value="screened">Screened</option>
                        </select>
                        <button class="btn btn-secondary btn-small" onclick="loadCallHistory()">Refresh</button>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>From</th>
                                <th>Caller Info</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Recording</th>
                            </tr>
                        </thead>
                        <tbody id="call-history-body">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <div class="empty-state-icon"></div>
                                    <p>No call history yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Settings -->
            <div id="tab-settings" class="tab-content">
                <div class="card">
                    <h2>⚙️ Protection Settings</h2>
                    
                    <div class="input-group">
                        <label>Forward Approved Calls To:</label>
                        <input type="tel" id="forwarding-number" placeholder="+1 (555) 123-4567">
                        <small>Your real phone number where screened calls will be transferred</small>
                    </div>

                    <div class="input-group">
                        <label>Unknown Caller Action:</label>
                        <select id="unknown-action">
                            <option value="screen">Screen with AI</option>
                            <option value="block">Block automatically</option>
                            <option value="allow">Allow through</option>
                        </select>
                        <small>How to handle calls from unknown numbers</small>
                    </div>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="sms-alerts" checked>
                            Send SMS alerts for blocked spam calls
                        </label>
                    </div>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="business-hours">
                            Only screen during business hours (9 AM - 5 PM)
                        </label>
                    </div>

                    <div class="input-group">
                        <label>Voicemail Greeting (optional):</label>
                        <input type="text" id="voicemail-greeting" placeholder="Hi, you've reached my RootCall protected line...">
                        <small>Custom message for voicemail</small>
                    </div>

                    <button class="btn" onclick="saveSettings()"> Save All Settings</button>
                </div>

                <div class="card">
                    <h2>�� Usage & Billing</h2>
                    <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                        <div>
                            <strong>Current Plan:</strong><br>
                            <span id="current-plan">Essential</span>
                        </div>
                        <div>
                            <strong>Monthly Cost:</strong><br>
                            $9.99/month
                        </div>
                        <div>
                            <strong>Next Billing:</strong><br>
                            <span id="next-billing">Dec 10, 2024</span>
                        </div>
                    </div>
                    <br>
                    <button class="btn btn-secondary">Upgrade Plan</button>
                    <button class="btn btn-secondary">Cancel Subscription</button>
                </div>
            </div>

            <!-- Tab: Trusted Contacts -->
            <div id="tab-contacts" class="tab-content">
                <div class="card">
                    <h2>✅ Trusted Contacts</h2>
                    <p style="margin-bottom:25px;color:#666;">These contacts bypass AI screening and are forwarded directly to you</p>
                    
                    <div class="input-group">
                        <label>Add New Trusted Contact:</label>
                        <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:10px;">
                            <input type="text" id="contact-name" placeholder="Name (e.g., Mom)">
                            <input type="tel" id="contact-number" placeholder="+1 (555) 123-4567">
                            <button class="btn" onclick="addTrustedContact()">Add</button>
                        </div>
                    </div>

                    <h3 style="margin:30px 0 15px;">Your Trusted Contacts:</h3>
                    <ul id="trusted-list" class="contact-list">
                        <li class="empty-state">
                            <div class="empty-state-icon"></div>
                            <p>No trusted contacts yet. Add your family and friends above.</p>
                        </li>
                    </ul>
                </div>

                <div class="card">
                    <h2> Blocked Numbers</h2>
                    <p style="margin-bottom:25px;color:#666;">Permanently block specific numbers</p>
                    
                    <div class="input-group">
                        <div style="display:grid;grid-template-columns:1fr auto;gap:10px;">
                            <input type="tel" id="block-number" placeholder="+1 (555) 999-9999">
                            <button class="btn btn-danger" onclick="blockNumber()">Block Number</button>
                        </div>
                    </div>

                    <ul id="blocked-list" class="contact-list">
                        <li class="empty-state">
                            <p>No blocked numbers</p>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Tab: Fraud Alerts -->
            <div id="tab-fraud" class="tab-content">
                <div class="card">
                    <h2>⚠️ Current Fraud Alerts & Scams to Watch</h2>
                    <p style="margin-bottom:25px;color:#666;">Stay informed about the latest phone scams. RootCall automatically blocks these!</p>

                    <div class="fraud-item">
                        <h4>️ IRS/Tax Scam Calls</h4>
                        <p><strong>What they say:</strong> "You owe back taxes. Pay immediately or face arrest."</p>
                        <p><strong>Red flags:</strong> Threatening language, demands for immediate payment, requests for gift cards/wire transfers</p>
                        <p><strong>Truth:</strong> The IRS NEVER initiates contact by phone. They always send letters first.</p>
                    </div>

                    <div class="fraud-item">
                        <h4> Tech Support Scams</h4>
                        <p><strong>What they say:</strong> "We detected a virus on your computer. Let us fix it remotely."</p>
                        <p><strong>Red flags:</strong> Unsolicited calls claiming to be Microsoft/Apple/Norton</p>
                        <p><strong>Truth:</strong> Tech companies don't make cold calls about viruses. Ever.</p>
                    </div>

                    <div class="fraud-item">
                        <h4> Prize/Lottery Scams</h4>
                        <p><strong>What they say:</strong> "Congratulations! You've won $1 million! Just pay $500 in fees to claim it."</p>
                        <p><strong>Red flags:</strong> You never entered a contest, they ask for money to claim prize</p>
                        <p><strong>Truth:</strong> Real prizes never require upfront payment.</p>
                    </div>

                    <div class="fraud-item">
                        <h4> Grandparent Scam</h4>
                        <p><strong>What they say:</strong> "Grandma, it's me! I'm in trouble and need money urgently."</p>
                        <p><strong>Red flags:</strong> Urgency, requests for secrecy, wire transfer requests</p>
                        <p><strong>Truth:</strong> Always verify by calling your family member back at their known number.</p>
                    </div>

                    <div class="fraud-item">
                        <h4> Credit Card/Bank Fraud</h4>
                        <p><strong>What they say:</strong> "Suspicious activity on your account. Verify your details now."</p>
                        <p><strong>Red flags:</strong> Asking for full card numbers, SSN, or account passwords</p>
                        <p><strong>Truth:</strong> Banks never ask for full credentials over the phone. Hang up and call the number on your card.</p>
                    </div>

                    <div class="fraud-item">
                        <h4> Social Security Scams</h4>
                        <p><strong>What they say:</strong> "Your SSN has been suspended due to suspicious activity."</p>
                        <p><strong>Red flags:</strong> SSN can't be "suspended," threats of legal action</p>
                        <p><strong>Truth:</strong> Social Security Administration doesn't call about suspensions.</p>
                    </div>

                    <div class="fraud-item">
                        <h4>⚡ Utility Shutoff Scams</h4>
                        <p><strong>What they say:</strong> "Your electricity will be shut off in 30 minutes unless you pay now."</p>
                        <p><strong>Red flags:</strong> Extreme urgency, demands for immediate payment via gift cards</p>
                        <p><strong>Truth:</strong> Utilities send multiple notices before disconnection.</p>
                    </div>

                    <div class="fraud-item">
                        <h4> Medicare/Health Insurance Scams</h4>
                        <p><strong>What they say:</strong> "We need to verify your Medicare number to send your new card."</p>
                        <p><strong>Red flags:</strong> Requesting personal info, offering "free" medical equipment</p>
                        <p><strong>Truth:</strong> Medicare will never call asking for your number.</p>
                    </div>
                </div>

                <div class="card" style="background:linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);">
                    <h3 style="color:#2e7d32;">✅ How RootCall Protects You</h3>
                    <ul style="line-height:2;padding-left:20px;">
                        <li><strong>AI Detection:</strong> Identifies scam patterns in real-time</li>
                        <li><strong>Voice Analysis:</strong> Detects robocalls and voice spoofing</li>
                        <li><strong>Caller Verification:</strong> Asks suspicious callers to identify themselves</li>
                        <li><strong>Automatic Blocking:</strong> Known scam numbers never reach you</li>
                        <li><strong>Smart Learning:</strong> Gets better at detecting new scams over time</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Provision Modal -->
    <div id="provision-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeProvisionModal()">&times;</span>
            <h2 style="color:var(--green);margin-bottom:20px;"> Get Your RootCall Number</h2>
            
            <div class="input-group">
                <label>Preferred Area Code (optional):</label>
                <input type="text" id="area-code" placeholder="813" maxlength="3">
                <small>Enter your preferred 3-digit area code, or leave blank for automatic</small>
            </div>

            <div style="background:var(--ivory);padding:15px;border-radius:12px;margin:20px 0;">
                <p style="font-size:0.9rem;color:#666;">
                    <strong>What happens next:</strong><br>
                    1. We'll purchase a phone number from Telnyx<br>
                    2. Set up your AI screening agent<br>
                    3. Activate your protection immediately<br>
                    <br>
                    This takes about 30 seconds.
                </p>
            </div>

            <button class="btn" onclick="provisionNumber()" style="width:100%;" id="provision-btn">
                 Provision My Number Now
            </button>

            <div id="provision-status" style="margin-top:20px;display:none;">
                <div class="spinner" style="width:30px;height:30px;"></div>
                <p id="provision-message" style="text-align:center;margin-top:10px;">Provisioning...</p>
            </div>
        </div>
    </div>

    <script>
        const API = 'https://rootcall.onrender.com';
        let userData = null;
        let currentTab = 'overview';
        let userPhoneNumber = '';

        // Check authentication
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/login.html';
        }

        // Tab Navigation
        function showTab(tabName) {
            currentTab = tabName;
            
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'calls') {
                loadCallHistory();
            }
        }

        // Load Dashboard
        async function loadDashboard() {
            try {
                const response = await fetch(API + '/api/rootcall/dashboard', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    localStorage.removeItem('token');
                    window.location.href = '/login.html';
                    return;
                }

                const data = await response.json();
                userData = data;

                document.getElementById('loading').style.display = 'none';

                if (!data.has_number) {
                    // Check if user has paid but provisioning failed
                    const user = JSON.parse(localStorage.getItem('user') || '{}');
                    if (user.has_subscription || data.has_subscription) {
                        // Payment successful but no number - show manual provision
                        document.getElementById('pending-provision').style.display = 'block';
                    } else {
                        // No payment yet - show payment prompt
                        document.getElementById('no-payment').style.display = 'block';
                    }
                    document.getElementById('user-name').textContent = data.user.name;
                } else {
                    // Has number - show full dashboard
                    document.getElementById('dashboard').style.display = 'block';
                    document.getElementById('user-name').textContent = data.user.name;
                    userPhoneNumber = data.phone.number;
                    document.getElementById('rootcall-number').textContent = formatPhoneNumber(data.phone.number);
                    
                    const purchasedDate = new Date(data.phone.purchased_at);
                    document.getElementById('purchased-date').textContent = 
                        `Activated: ${purchasedDate.toLocaleDateString()}`;

                    document.getElementById('stat-today').textContent = data.stats.calls_today;
                    document.getElementById('stat-blocked').textContent = data.stats.calls_blocked;
                    document.getElementById('stat-forwarded').textContent = data.stats.calls_forwarded;
                    document.getElementById('stat-total').textContent = data.stats.total_calls;

                    if (data.config) {
                        const forwardNum = data.config.forwarding_number || '';
                        document.getElementById('forwarding-number').value = forwardNum;
                        document.getElementById('quick-forward').value = forwardNum;
                        loadTrustedContacts(data.config.trusted_contacts || []);
                    }
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                alert('Failed to load dashboard. Please try again.');
            }
        }

        function formatPhoneNumber(num) {
            const cleaned = num.replace(/\D/g, '');
            const match = cleaned.match(/^1?(\d{3})(\d{3})(\d{4})$/);
            if (match) {
                return `(${match[1]}) ${match[2]}-${match[3]}`;
            }
            return num;
        }

        // OPTION 1: Copy Number Button
        function copyNumber() {
            const number = userPhoneNumber;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(number).then(() => {
                    alert('✅ Number copied to clipboard!\n\n' + formatPhoneNumber(number));
                });
            } else {
                // Fallback for older browsers
                const input = document.createElement('input');
                input.value = number;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                alert('✅ Number copied to clipboard!\n\n' + formatPhoneNumber(number));
            }
        }

        // OPTION 2: Manual Provision Modal
        function showProvisionModal() {
            document.getElementById('provision-modal').classList.add('active');
        }

        function closeProvisionModal() {
            document.getElementById('provision-modal').classList.remove('active');
        }

        // OPTION 3: Provision with Area Code Selection
        async function provisionNumber() {
            const areaCode = document.getElementById('area-code').value || '813';
            const btn = document.getElementById('provision-btn');
            const status = document.getElementById('provision-status');
            const message = document.getElementById('provision-message');

            btn.disabled = true;
            btn.textContent = 'Provisioning...';
            status.style.display = 'block';
            message.textContent = 'Step 1/4: Searching for available numbers...';

            try {
                const response = await fetch(API + '/api/rootcall/provision', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        area_code: areaCode
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    message.textContent = '✅ Success! Your number is ready!';
                    setTimeout(() => {
                        closeProvisionModal();
                        location.reload();
                    }, 2000);
                } else {
                    throw new Error(data.detail || 'Provisioning failed');
                }
            } catch (error) {
                console.error('Provisioning error:', error);
                message.textContent = '❌ Error: ' + error.message;
                btn.disabled = false;
                btn.textContent = 'Try Again';
            }
        }

        async function updateForwarding() {
            const number = document.getElementById('forwarding-number').value || 
                          document.getElementById('quick-forward').value;
            
            if (!number) {
                alert('Please enter a forwarding number');
                return;
            }

            try {
                const response = await fetch(API + '/api/rootcall/update-forwarding?forwarding_number=' + encodeURIComponent(number)', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    alert('✅ Forwarding number updated successfully!');
                    document.getElementById('forwarding-number').value = number;
                    document.getElementById('quick-forward').value = number;
                } else {
                    alert('Error: ' + (data.detail || 'Failed to update'));
                }
            } catch (error) {
                console.error('Error updating forwarding:', error);
                alert('Failed to update. Please try again.');
            }
        }

        async function addTrustedContact() {
            const name = document.getElementById('contact-name').value;
            const number = document.getElementById('contact-number').value;
            
            if (!number) {
                alert('Please enter a phone number');
                return;
            }

            try {
                const response = await fetch(API + '/api/rootcall/add-trusted-contact?phone_number=' + encodeURIComponent(number) + '&name=' + encodeURIComponent(name || 'Contact')', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('contact-name').value = '';
                    document.getElementById('contact-number').value = '';
                    loadTrustedContacts(data.contacts);
                    alert('✅ Trusted contact added!');
                } else {
                    alert('Error: ' + (data.detail || 'Failed to add'));
                }
            } catch (error) {
                console.error('Error adding contact:', error);
                alert('Failed to add contact. Please try again.');
            }
        }

        function loadTrustedContacts(contacts) {
            const list = document.getElementById('trusted-list');
            
            if (!contacts || contacts.length === 0) {
                list.innerHTML = `
                    <li class="empty-state">
                        <div class="empty-state-icon"></div>
                        <p>No trusted contacts yet. Add your family and friends above.</p>
                    </li>
                `;
                return;
            }

            list.innerHTML = contacts.map(contact => `
                <li class="contact-item">
                    <span style="font-weight:600;">${formatPhoneNumber(contact)}</span>
                    <button class="btn btn-danger btn-small" onclick="removeTrustedContact('${contact}')">Remove</button>
                </li>
            `).join('');
        }

        function removeTrustedContact(number) {
            alert('Remove functionality coming soon!');
        }

        function blockNumber() {
            const number = document.getElementById('block-number').value;
            if (!number) {
                alert('Please enter a number to block');
                return;
            }
            alert('Block number functionality coming soon!');
        }

        function saveSettings() {
            alert('Settings saved! (Full implementation coming soon)');
        }

        function loadCallHistory() {
            const tbody = document.getElementById('call-history-body');
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="empty-state">
                        <div class="empty-state-icon"></div>
                        <p>No call history yet. Calls will appear here once you start receiving them.</p>
                    </td>
                </tr>
            `;
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

        // Load on page load
        loadDashboard();
    </script>
</body>
</html>
