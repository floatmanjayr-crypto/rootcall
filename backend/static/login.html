<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RootCall â€” Sign In</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Sign in to your RootCall dashboard to manage your AI call shield." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --green:#0d3d2f;
      --green-700:#0b3629;
      --green-600:#124b39;
      --ivory:#f9f6f3;
      --ink:#0e1111;
      --muted:#44524c;
      --accent:#13a161;
      --shadow:0 10px 30px rgba(13,61,47,.12);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;
      padding:0;
      background:var(--ivory);
      color:var(--ink);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    a{color:inherit;text-decoration:none}
    .page{
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    header{
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter:saturate(180%) blur(6px);
      background:color-mix(in oklab, var(--ivory) 85%, white 15%);
      border-bottom:1px solid #ece7e2;
    }
    .nav{
      max-width:1120px;
      margin:0 auto;
      padding:14px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .logo{
      display:flex;
      align-items:center;
      gap:12px;
      font-weight:800;
      color:var(--green);
      letter-spacing:.5px;
    }
    .logo svg{width:42px;height:42px}
    .nav-actions{
      display:flex;
      align-items:center;
      gap:12px;
      font-size:.9rem;
    }
    .nav-link{
      color:var(--muted);
      font-weight:500;
    }
    .nav-link:hover{color:var(--green)}
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.6rem;
      padding:10px 18px;
      border-radius:999px;
      font-weight:700;
      letter-spacing:.02em;
      cursor:pointer;
      border:none;
      font-size:.9rem;
      transition:all .18s ease;
      width:100%;
    }
    .btn-primary{
      background:var(--green);
      color:#fff;
      box-shadow:var(--shadow);
    }
    .btn-primary:hover{
      filter:brightness(1.05);
      transform:translateY(-1px);
      box-shadow:0 14px 32px rgba(13,61,47,.35);
    }
    .btn-primary:disabled{
      opacity:.6;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    /* Main layout */
    .main{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 16px;
    }
    .shell{
      max-width:960px;
      width:100%;
      display:grid;
      grid-template-columns:1.1fr .9fr;
      gap:40px;
      align-items:center;
    }
    .promo{
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .badge{
      display:inline-block;
      background:#e8f5ef;
      color:var(--green);
      padding:6px 12px;
      border-radius:999px;
      font-weight:700;
      font-size:.78rem;
      text-transform:uppercase;
      letter-spacing:.12em;
    }
    .promo-title{
      font-size:clamp(1.9rem,3vw + 1rem,2.4rem);
      line-height:1.1;
      color:var(--green);
      font-weight:800;
    }
    .promo-text{
      font-size:.98rem;
      color:var(--muted);
      max-width:420px;
    }
    .promo-list{
      list-style:none;
      padding:0;
      margin:10px 0 0;
      font-size:.9rem;
      color:var(--muted);
    }
    .promo-list li{
      display:flex;
      gap:8px;
      align-items:flex-start;
      margin-bottom:6px;
    }
    .promo-list li span:first-child{
      color:var(--accent);
      font-weight:900;
      margin-top:1px;
    }

    /* Card */
    .card{
      background:#fff;
      border-radius:var(--radius);
      padding:28px 26px 26px;
      box-shadow:var(--shadow);
      border:1px solid #eee2d8;
    }
    .card h1{
      font-size:1.6rem;
      margin:0 0 6px;
      color:var(--green);
    }
    .card p{
      margin:0 0 18px;
      font-size:.95rem;
      color:var(--muted);
    }
    .field{
      margin-bottom:16px;
    }
    .field label{
      display:block;
      font-size:.82rem;
      font-weight:600;
      margin-bottom:6px;
      color:#111827;
    }
    .field input{
      width:100%;
      padding:11px 12px;
      border-radius:10px;
      border:2px solid #e5e7eb;
      font-size:.95rem;
      outline:none;
      transition:border-color .18s,box-shadow .18s,background .18s;
      background:white;
    }
    .field input:focus{
      border-color:var(--green);
      box-shadow:0 0 0 1px rgba(13,61,47,.12);
      background:#f9fafb;
    }
    .helper-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:16px;
      font-size:.82rem;
      color:#6b7280;
    }
    .helper-row a{
      color:var(--green);
      font-weight:600;
    }
    .helper-row a:hover{text-decoration:underline}

    .message{
      font-size:.85rem;
      padding:10px 12px;
      border-radius:10px;
      margin-bottom:14px;
      display:none;
    }
    .message.error{
      display:block;
      background:#fef2f2;
      color:#991b1b;
      border:1px solid #fecaca;
    }
    .message.success{
      display:block;
      background:#ecfdf5;
      color:#166534;
      border:1px solid #bbf7d0;
    }
    .small-note{
      font-size:.8rem;
      color:#9ca3af;
      text-align:center;
      margin-top:12px;
    }
    .small-note a{
      color:var(--green);
      font-weight:600;
    }
    .small-note a:hover{text-decoration:underline}

    footer{
      border-top:1px solid #ece7e2;
      margin-top:10px;
    }
    .foot{
      max-width:1120px;
      margin:0 auto;
      padding:18px 24px 26px;
      display:flex;
      justify-content:space-between;
      gap:18px;
      align-items:center;
      font-size:.85rem;
      color:var(--muted);
    }

    @media (max-width:900px){
      .shell{
        grid-template-columns:1fr;
        max-width:480px;
      }
      .promo{
        order:-1;
        text-align:left;
      }
    }
    @media (max-width:640px){
      .nav{padding:10px 16px}
      .main{padding:24px 12px 32px}
      .foot{
        flex-direction:column;
        align-items:flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Header matching landing -->
    <header>
      <div class="nav">
        <div class="logo">
          <svg viewBox="0 0 64 64" aria-hidden="true">
            <path fill="var(--green)" d="M32 6c7 4 15 6 23 7-1 20-10 34-23 39C19 47 10 33 9 13c8-1 16-3 23-7z"/>
            <path fill="#fff" d="M37.9 42.1c-4.6-1.9-8.6-5.9-10.5-10.5-.5-1.3 0-2.8 1.2-3.5l2.7-1.6c.9-.5 1.2-1.6.8-2.5l-2-4.2c-.5-1.1-1.8-1.6-2.9-1.1l-2.9 1.3c-2.1.9-3.3 3.1-3 5.4.9 6.8 6.9 12.8 13.7 13.7 2.3.3 4.5-.9 5.4-3l1.3-2.9c.5-1.1 0-2.4-1.1-2.9l-4.2-2c-.9-.4-2 .0-2.5.8l-1.6 2.7c-.7 1.2-2.2 1.7-3.5 1.2z"/>
          </svg>
          <span>ROOTCALL</span>
        </div>
        <div class="nav-actions">
          <a href="/" class="nav-link">Back to Home</a>
        </div>
      </div>
    </header>

    <!-- Main content -->
    <main class="main">
      <div class="shell">
        <!-- Left side promo (like landing copy) -->
        <section class="promo" aria-label="RootCall benefits">
          <span class="badge">Sign in to your shield</span>
          <h1 class="promo-title">Manage your RootCall protection.</h1>
          <p class="promo-text">
            Check your shield numbers, review call activity, and update trusted contacts â€” all from a simple dashboard.
          </p>
          <ul class="promo-list">
            <li><span>âœ“</span><span>AI answers unknown calls first, so scammers never reach you directly.</span></li>
            <li><span>âœ“</span><span>Forward only verified callers to your real number.</span></li>
            <li><span>âœ“</span><span>Caregiver-friendly view for families helping loved ones.</span></li>
          </ul>
        </section>

        <!-- Right side login card -->
        <section class="card" aria-label="Sign in form">
          <h1>Sign in to RootCall</h1>
          <p>Enter your email and password to access your dashboard.</p>

          <div id="login-message" class="message"></div>

          <form id="login-form" onsubmit="return false;">
            <div class="field">
              <label for="email">Email</label>
              <input id="email" type="email" required autocomplete="email" placeholder="you@example.com">
            </div>
            <div class="field">
              <label for="password">Password</label>
              <input id="password" type="password" required autocomplete="current-password" placeholder="Enter your password">
            </div>

            <div class="helper-row">
              <span></span>
              <a href="/">Need a plan? Go to homepage</a>
            </div>

            <button type="button" id="login-btn" class="btn btn-primary">
              Sign In
            </button>
          </form>

          <div class="small-note">
            Already subscribed but can't sign in? Contact support and we'll help you reset your access.
          </div>
        </section>
      </div>
    </main>

    <footer>
      <div class="foot">
        <span>Â© <span id="year"></span> RootCall â€” Peace-of-Mind Guarantee.</span>
        <span>
          <a href="/privacy.html" class="nav-link" style="margin-right:14px;">Privacy</a>
          <a href="/terms.html" class="nav-link">Terms</a>
        </span>
      </div>
    </footer>
  </div>

  <script>
    // ============================================
    // ðŸŒ API Configuration - Points to Render Backend
    // ============================================
    const API_BASE_URL = const API_BASE_URL = window.location.origin;


     document.getElementById('year').textContent = new Date().getFullYear();

    const messageBox = document.getElementById('login-message');
    const loginBtn = document.getElementById('login-btn');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');

    function showMessage(text, type = 'error') {
      messageBox.textContent = text;
      messageBox.className = 'message ' + type;
      messageBox.style.display = 'block';
    }

    async function handleLogin() {
      messageBox.style.display = 'none';

      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      if (!email || !password) {
        showMessage('Please enter your email and password.', 'error');
        return;
      }

      loginBtn.disabled = true;
      loginBtn.textContent = 'Signing in...';

      try {
        const body = new URLSearchParams();
        body.append('username', email);
        body.append('password', password);

        console.log('ðŸ” Attempting login with email:', email);
        console.log('ðŸŒ API endpoint:', `${API_BASE_URL}/api/auth/login`);

        const res = await fetch(`${API_BASE_URL}/api/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: body.toString()
        });

        console.log('ðŸ“¡ Response status:', res.status);

        // âœ… FIX: Read response body ONCE as text first
        const responseText = await res.text();
        console.log('ðŸ“¦ Raw response:', responseText);

        // Try to parse as JSON
        let data;
        try {
          data = JSON.parse(responseText);
          console.log('âœ… Parsed data:', data);
        } catch (e) {
          console.error('âŒ Could not parse JSON:', e);
          throw new Error('Invalid server response: ' + responseText.substring(0, 100));
        }

        if (!res.ok) {
          const errorMsg = data.detail || data.message || `Login failed (${res.status})`;
          console.error('âŒ Login error:', errorMsg);
          showMessage(errorMsg, 'error');
          return;
        }

        // Success!
        console.log('âœ… Login successful');
        
        if (data.access_token) {
          localStorage.setItem('access_token', data.access_token);
        }
        if (data.user) {
          localStorage.setItem('user', JSON.stringify(data.user));
        }

        showMessage('Login successful! Redirecting...', 'success');

        setTimeout(() => {
          window.location.href = '/client-portal.html';
        }, 800);

      } catch (err) {
        console.error('ðŸ’¥ Error:', err);
        showMessage(err.message || 'Network error. Please try again.', 'error');
      } finally {
        // âœ… FIX: Always re-enable button in finally block
        loginBtn.disabled = false;
        loginBtn.textContent = 'Sign In';
      }
    }

    // Click handler
    loginBtn.addEventListener('click', handleLogin);

    // Enter key handler
    emailInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') handleLogin();
    });
    passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') handleLogin();
    });

    // Check if already logged in
    const existingToken = localStorage.getItem('access_token');
    if (existingToken) {
      console.log('ðŸ”‘ Already logged in, redirecting...');
      window.location.href = '/client-portal.html';
    }
  </script>
</body>
</html>
