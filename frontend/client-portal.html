<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>RootCall — Client Portal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    :root{--bg:#0A1220;--fg:#E6F0FF;--card:rgba(255,255,255,.04);--border:rgba(255,255,255,.12);--accent:#2FD7C4}
    *{box-sizing:border-box} html,body{margin:0;height:100%}
    body{font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--fg)}
    .container{max-width:1000px;margin:0 auto;padding:24px}
    .header{display:flex;justify-content:space-between;align-items:center;margin:24px 0}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .grid{display:grid;gap:16px} .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--accent);color:var(--accent);background:transparent;cursor:pointer;font-weight:700}
    .muted{opacity:.85}
    .notice{padding:10px 12px;border-radius:8px;background:#12203f;border:1px solid var(--border);margin:12px 0;display:none}
    code{background:#0e1730;border:1px solid var(--border);padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h2>RootCall — Client Portal</h2>
      <div><button id="logout" class="btn">Log out</button></div>
    </div>

    <div id="flash" class="notice"></div>

    <div class="grid grid-2">
      <div class="card">
        <h3>Today</h3>
        <div class="muted">Calls and protection summary</div>
        <div id="today" style="margin-top:10px">Loading…</div>
      </div>
      <div class="card">
        <h3>Account</h3>
        <div class="muted">Plan & status</div>
        <div id="acct" style="margin-top:10px">Loading…</div>
      </div>
    </div>
  </div>

  <script>
    const API = ''; // same-origin
    function getToken(){ try{return localStorage.getItem('token')||localStorage.getItem('authToken');}catch(e){return null;} }
    function setFlash(t, bad=false){
      const f = document.getElementById('flash');
      f.textContent = t; f.style.display = 'block'; f.style.color = bad ? '#ffb4b4' : '#9ff7c6';
      setTimeout(()=>{f.style.display='none';}, 3000);
    }
    async function api(path, opts={}){
      const t = getToken();
      const headers = Object.assign({'Content-Type':'application/json'}, opts.headers||{});
      if(t) headers['Authorization'] = 'Bearer ' + t;
      const res = await fetch((API||'') + path, {
        method: opts.method||'GET',
        headers,
        body: opts.body ? JSON.stringify(opts.body) : undefined,
        credentials: 'include' // allow cookie-based auth too
      });
      let data=null; try{ data = await res.json(); }catch(_){}
      if(!res.ok) throw new Error((data && (data.detail||data.message)) || ('HTTP '+res.status));
      return data;
    }

    async function load(){
      try{
        const d = await api('/api/rootcall/dashboard');
        const s = d.stats || {};
        document.getElementById('today').innerHTML =
          '<div>Calls today: <strong>' + (s.calls_today ?? '—') + '</strong></div>' +
          '<div>Blocked: <strong>' + (s.blocked ?? '—') + '</strong></div>';
        document.getElementById('acct').innerHTML =
          '<div>User: <code>' + ((d.user && d.user.user_id) || 'current') + '</code></div>' +
          '<div>Status: <strong>Active</strong></div>';
      }catch(e){
        // Not authenticated -> go back to login (adjust if your login path differs)
        window.location.href = '/login.html';
      }
    }

    document.getElementById('logout').onclick = async ()=>{
      try{ await api('/api/auth/logout', {method:'POST'}); }catch(_){}
      try{ localStorage.removeItem('token'); localStorage.removeItem('authToken'); }catch(_){}
      window.location.href = '/';
    };

    load();
  </script>
</body>
</html>
